<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>code-extract</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: { extend: { colors: {
        canvas: { DEFAULT: '#08090d', raised: '#0c0d12' },
        accent: '#00f0ff',
      }}}
    }
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/cytoscape@3.30.4/dist/cytoscape.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dagre@0.8.5/dist/dagre.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/cytoscape-dagre@2.5.0/cytoscape-dagre.js"></script>
  <link rel="stylesheet" href="/styles.css">
</head>
<body class="bg-canvas text-[rgba(255,255,255,0.92)] h-screen flex flex-col overflow-hidden">

  <!-- Main 3-column layout -->
  <div class="flex flex-1 overflow-hidden">

    <!-- ═══ Left Sidebar — Navigation ═══ -->
    <aside class="w-64 border-r flex flex-col shrink-0" style="border-color: var(--border-default); background: var(--canvas-raised)">

      <!-- Brand -->
      <div class="px-4 pt-4 pb-2 flex items-center gap-2">
        <span class="text-base font-bold tracking-tight" style="color: var(--text-primary)">code-extract</span>
        <span class="text-[0.625rem] px-1.5 py-0.5 rounded" style="background: var(--accent-dimmed); color: var(--accent)">v0.3</span>
      </div>

      <!-- Path input + Run Scan -->
      <div class="px-4 py-2 space-y-2">
        <div class="relative">
          <input id="path-input" type="text" placeholder="~/my-project"
            class="glass-input w-full px-3 py-2 text-sm" autocomplete="off">
          <div id="autocomplete-dropdown" class="autocomplete-dropdown hidden"></div>
        </div>
        <button id="scan-btn" onclick="app.scan()"
          class="neon-btn-outlined neon-btn-cyan w-full justify-center py-2 text-sm font-medium">
          Run Scan
        </button>
      </div>

      <!-- Nav sections -->
      <nav class="flex-1 overflow-y-auto px-2 py-1 space-y-0.5">
        <div class="nav-section-label">Analysis</div>
        <div class="nav-item active" data-tab="scan" onclick="app.switchTab('scan')">
          <span class="nav-icon">&#x2302;</span> Scan Results
        </div>
        <div class="nav-item" data-tab="catalog" onclick="app.switchTab('catalog')">
          <span class="nav-icon">&#x25A6;</span> Catalog
        </div>
        <div class="nav-item" data-tab="health" onclick="app.switchTab('health')">
          <span class="nav-icon">&#x2665;</span> Health
        </div>
        <div class="nav-item" data-tab="architecture" onclick="app.switchTab('architecture')">
          <span class="nav-icon">&#x2B21;</span> Architecture
        </div>
        <div class="nav-item" data-tab="deadcode" onclick="app.switchTab('deadcode')">
          <span class="nav-icon">&#x2717;</span> Dead Code
        </div>

        <div class="nav-section-label mt-2">Tools</div>
        <div class="nav-item" data-tab="docs" onclick="app.switchTab('docs')">
          <span class="nav-icon">&#x2630;</span> Docs
        </div>
        <div class="nav-item" data-tab="compare" onclick="app.switchTab('compare')">
          <span class="nav-icon">&#x2194;</span> Compare
        </div>
        <div class="nav-item" data-tab="tour" onclick="app.switchTab('tour')">
          <span class="nav-icon">&#x279C;</span> Tour
        </div>
        <div class="nav-item" data-tab="clone" onclick="app.switchTab('clone')">
          <span class="nav-icon">&#x2704;</span> Clone
        </div>
        <div class="nav-item" data-tab="boilerplate" onclick="app.switchTab('boilerplate')">
          <span class="nav-icon">&#x2699;</span> Boilerplate
        </div>
        <div class="nav-item" data-tab="migration" onclick="app.switchTab('migration')">
          <span class="nav-icon">&#x21C4;</span> Migration
        </div>
        <div class="nav-item" data-tab="remix" onclick="app.switchTab('remix')">
          <span class="nav-icon">&#x2726;</span> Remix Board
        </div>

        <div class="nav-section-label mt-2">Intelligence</div>
        <div class="nav-item" data-tab="ai" onclick="app.toggleAIWidget()">
          <span class="nav-icon">&#x2604;</span> AI Copilot
        </div>

        <!-- Filters (Scan tab only) -->
        <div id="sidebar-filters" class="mt-3 space-y-2 px-1">
          <div class="nav-section-label px-0">Filters</div>
          <select id="filter-language" onchange="app.applyFilters()"
            class="glass-input w-full px-2 py-1.5 text-xs">
            <option value="">All Languages</option>
          </select>
          <select id="filter-type" onchange="app.applyFilters()"
            class="glass-input w-full px-2 py-1.5 text-xs">
            <option value="">All Types</option>
          </select>
          <input id="filter-search" type="text" placeholder="Search names..." oninput="app.applyFilters()"
            class="glass-input w-full px-2 py-1.5 text-xs">
        </div>
      </nav>

      <!-- Recent Scans -->
      <div class="px-4 pb-2 overflow-y-auto max-h-32">
        <div class="nav-section-label px-0">Recent Scans</div>
        <div id="recent-scans" class="mt-1 space-y-0.5 text-xs"></div>
      </div>

    </aside>

    <!-- ═══ Main Content ═══ -->
    <main class="flex-1 flex flex-col overflow-hidden">

      <!-- ═══ Tab: Scan ═══ -->
      <div id="tab-scan" class="tab-panel active flex flex-col flex-1 overflow-hidden">
        <div class="info-bar shrink-0">
          <span id="item-count" style="color: var(--text-secondary)">0 items</span>
          <span class="mx-2" style="color: var(--text-muted)">&bull;</span>
          <span id="selected-count-info" style="color: var(--text-muted)">0 selected</span>
          <div class="flex-1"></div>
          <label class="flex items-center gap-1.5" style="color: var(--text-muted)">
            <input type="checkbox" id="select-all" onchange="app.toggleAll(this.checked)">
            Select All
          </label>
          <span id="scan-dir" class="ml-3 truncate max-w-xs" style="color: var(--text-muted)"></span>
        </div>
        <div id="results" class="flex-1 overflow-y-auto">
          <div id="empty-state" class="flex items-center justify-center h-full" style="color: var(--text-muted)">
            <div class="text-center space-y-2">
              <div class="text-4xl opacity-30">{ }</div>
              <p>Enter a project path and click Run Scan</p>
            </div>
          </div>
          <table id="results-table" class="w-full text-sm hidden">
            <thead>
              <tr style="border-bottom: 1px solid var(--border-default)">
                <th class="w-8"></th>
                <th class="text-left px-2 py-1.5 text-[0.625rem] font-semibold uppercase tracking-wider" style="color: var(--text-muted)">Type</th>
                <th class="text-left px-2 py-1.5 text-[0.625rem] font-semibold uppercase tracking-wider" style="color: var(--text-muted)">Name</th>
                <th class="text-left px-2 py-1.5 text-[0.625rem] font-semibold uppercase tracking-wider" style="color: var(--text-muted)">Lang</th>
                <th class="text-left px-2 py-1.5 text-[0.625rem] font-semibold uppercase tracking-wider" style="color: var(--text-muted)">Deps</th>
                <th class="text-left px-2 py-1.5 text-[0.625rem] font-semibold uppercase tracking-wider" style="color: var(--text-muted)">Size</th>
                <th class="text-left px-2 py-1.5 text-[0.625rem] font-semibold uppercase tracking-wider" style="color: var(--text-muted)">Health</th>
                <th class="text-right pr-4 py-1.5 text-[0.625rem] font-semibold uppercase tracking-wider" style="color: var(--text-muted)">Lines</th>
              </tr>
            </thead>
            <tbody id="results-body"></tbody>
          </table>
        </div>
      </div>

      <!-- ═══ Tab: Catalog ═══ -->
      <div id="tab-catalog" class="tab-panel flex-1 overflow-y-auto p-6 hidden">
        <div id="catalog-empty" class="tab-empty-state">
          <p>Scan a project first to build the component catalog</p>
        </div>
        <div id="catalog-content" class="hidden">
          <div class="flex items-center gap-4 mb-4">
            <h2 class="text-lg font-semibold" style="color: var(--text-primary)">Component Catalog</h2>
            <input id="catalog-search" type="text" placeholder="Search components..."
              class="glass-input px-3 py-1.5 text-xs w-64" oninput="app.filterCatalog()">
            <select id="catalog-lang-filter" class="glass-input px-2 py-1.5 text-xs" onchange="app.filterCatalog()">
              <option value="">All Languages</option>
            </select>
            <div class="flex-1"></div>
            <button onclick="app.exportCatalogHTML()" class="neon-btn-outlined neon-btn-cyan text-xs py-1">Export HTML</button>
          </div>
          <div id="catalog-grid" class="card-grid"></div>
        </div>
      </div>

      <!-- ═══ Tab: Architecture ═══ -->
      <div id="tab-architecture" class="tab-panel flex-1 overflow-hidden hidden">
        <div id="arch-empty" class="tab-empty-state">
          <p>Scan a project first to view architecture</p>
        </div>
        <div id="arch-content" class="hidden flex flex-1 h-full overflow-hidden">
          <!-- Graph area -->
          <div class="flex-1 relative overflow-hidden min-w-0" style="border-right: 1px solid var(--border-default)">
            <!-- Controls overlay -->
            <div id="arch-controls" class="arch-controls">
              <button class="arch-ctrl-btn active" data-layout="dagre" onclick="app.setArchLayout('dagre')">Hierarchical</button>
              <button class="arch-ctrl-btn" data-layout="cose" onclick="app.setArchLayout('cose')">Force</button>
              <button class="arch-ctrl-btn" data-layout="circle" onclick="app.setArchLayout('circle')">Circular</button>
              <div style="width:1px;height:20px;background:var(--border-default);flex-shrink:0"></div>
              <button class="arch-ctrl-btn" onclick="app.archFitView()">Fit</button>
              <button class="arch-ctrl-btn" onclick="app.archResetHighlight()">Reset</button>
              <button class="arch-ctrl-btn" onclick="app.exportArchPNG()">Export PNG</button>
              <input id="arch-search" type="text" placeholder="Search nodes..." class="arch-search-input" oninput="app.archSearchNodes(this.value)">
            </div>
            <!-- Legend overlay -->
            <div id="arch-legend" class="arch-legend">
              <div class="arch-legend-title">Node Types</div>
              <div class="arch-legend-item"><span class="arch-legend-dot" style="background:#f78166"></span>Module</div>
              <div class="arch-legend-item"><span class="arch-legend-dot" style="background:#d2a8ff"></span>Class</div>
              <div class="arch-legend-item"><span class="arch-legend-dot" style="background:#79c0ff"></span>Component</div>
              <div class="arch-legend-item"><span class="arch-legend-dot" style="background:#7ee787"></span>Function</div>
              <div class="arch-legend-item"><span class="arch-legend-dot" style="background:#ffa657"></span>Method</div>
            </div>
            <!-- Stats bar -->
            <div id="arch-stats" class="arch-stats"></div>
            <!-- Tooltip -->
            <div id="arch-tooltip" class="arch-tooltip"></div>
            <!-- Loading overlay -->
            <div id="arch-loading" class="arch-loading hidden">
              <div class="spinner" style="width:1.5rem;height:1.5rem"></div>
              <span>Analyzing architecture...</span>
            </div>
            <!-- Cytoscape container -->
            <div id="arch-diagram" style="position:absolute;top:0;left:0;right:0;bottom:0;"></div>
          </div>
          <!-- Module sidebar -->
          <div class="w-72 overflow-y-auto p-4 shrink-0">
            <h3 class="text-sm font-semibold mb-3" style="color: var(--text-secondary)">Modules</h3>
            <div id="arch-modules"></div>
          </div>
        </div>
      </div>

      <!-- ═══ Tab: Health ═══ -->
      <div id="tab-health" class="tab-panel flex-1 overflow-y-auto p-6 hidden">
        <div id="health-empty" class="tab-empty-state">
          <p>Scan a project first to view health metrics</p>
        </div>
        <div id="health-content" class="hidden">
          <div class="flex items-center gap-4 mb-6">
            <h2 class="text-lg font-semibold" style="color: var(--text-primary)">Refactoring Radar</h2>
            <div id="health-score" class="metric-card-inline"></div>
          </div>
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div>
              <h3 class="text-sm font-semibold mb-3" style="color: var(--text-secondary)">Long Functions</h3>
              <div id="health-long-fns" class="space-y-2"></div>
            </div>
            <div>
              <h3 class="text-sm font-semibold mb-3" style="color: var(--text-secondary)">Duplications</h3>
              <div id="health-duplicates" class="space-y-2"></div>
            </div>
            <div>
              <h3 class="text-sm font-semibold mb-3" style="color: var(--text-secondary)">Coupling</h3>
              <div id="health-coupling" class="space-y-2"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- ═══ Tab: Docs ═══ -->
      <div id="tab-docs" class="tab-panel flex-1 overflow-y-auto p-6 hidden">
        <div id="docs-empty" class="tab-empty-state">
          <p>Scan a project first to generate documentation</p>
        </div>
        <div id="docs-content" class="hidden">
          <div class="flex items-center gap-4 mb-4">
            <h2 class="text-lg font-semibold" style="color: var(--text-primary)">Living Documentation</h2>
            <label class="flex items-center gap-2 text-xs" style="color: var(--text-secondary)">
              <input type="checkbox" id="docs-watch-toggle" onchange="app.toggleDocsWatch(this.checked)">
              Watch Mode
            </label>
            <span id="docs-live-indicator" class="hidden text-xs flex items-center gap-1" style="color: var(--success)">
              <span class="w-2 h-2 rounded-full inline-block animate-pulse" style="background: var(--success)"></span> Live
            </span>
            <div class="flex-1"></div>
            <button onclick="app.exportDocsMarkdown()" class="neon-btn-outlined neon-btn-cyan text-xs py-1">Export Markdown</button>
          </div>
          <div id="docs-body"></div>
        </div>
      </div>

      <!-- ═══ Tab: Compare ═══ -->
      <div id="tab-compare" class="tab-panel flex-1 overflow-y-auto p-6 hidden">
        <div class="flex items-center gap-4 mb-4">
          <h2 class="text-lg font-semibold" style="color: var(--text-primary)">Semantic Diff</h2>
        </div>
        <div class="flex gap-4 mb-4">
          <div class="flex-1">
            <label class="text-xs mb-1 block" style="color: var(--text-secondary)">Source Path (Before)</label>
            <input id="diff-path-a" type="text" placeholder="~/project-v1"
              class="glass-input w-full px-3 py-2 text-sm">
          </div>
          <div class="flex-1">
            <label class="text-xs mb-1 block" style="color: var(--text-secondary)">Target Path (After)</label>
            <input id="diff-path-b" type="text" placeholder="~/project-v2"
              class="glass-input w-full px-3 py-2 text-sm">
          </div>
          <button onclick="app.runDiff()" class="neon-btn-outlined neon-btn-cyan self-end py-2 px-4 text-sm">Compare</button>
        </div>
        <div id="diff-summary" class="hidden mb-4"></div>
        <div id="diff-results"></div>
      </div>

      <!-- ═══ Tab: Dead Code ═══ -->
      <div id="tab-deadcode" class="tab-panel flex-1 overflow-y-auto p-6 hidden">
        <div id="deadcode-empty" class="tab-empty-state">
          <p>Scan a project first to detect dead code</p>
        </div>
        <div id="deadcode-content" class="hidden">
          <div class="flex items-center gap-4 mb-4">
            <h2 class="text-lg font-semibold" style="color: var(--text-primary)">Dead Code Detector</h2>
            <span id="deadcode-count" class="text-xs" style="color: var(--text-muted)"></span>
          </div>
          <table class="w-full text-sm">
            <thead>
              <tr style="border-bottom: 1px solid var(--border-default)">
                <th class="text-left px-3 py-2 text-[0.625rem] font-semibold uppercase" style="color: var(--text-muted)">Name</th>
                <th class="text-left px-3 py-2 text-[0.625rem] font-semibold uppercase" style="color: var(--text-muted)">Type</th>
                <th class="text-left px-3 py-2 text-[0.625rem] font-semibold uppercase" style="color: var(--text-muted)">File</th>
                <th class="text-left px-3 py-2 text-[0.625rem] font-semibold uppercase" style="color: var(--text-muted)">Confidence</th>
                <th class="text-left px-3 py-2 text-[0.625rem] font-semibold uppercase" style="color: var(--text-muted)">Reason</th>
              </tr>
            </thead>
            <tbody id="deadcode-body"></tbody>
          </table>
        </div>
      </div>

      <!-- ═══ Tab: Tour ═══ -->
      <div id="tab-tour" class="tab-panel flex-1 overflow-hidden hidden">
        <div id="tour-empty" class="tab-empty-state">
          <p>Scan a project first to generate a codebase tour</p>
        </div>
        <div id="tour-content" class="hidden flex h-full">
          <div class="w-48 overflow-y-auto p-3" style="border-right: 1px solid var(--border-default)">
            <h3 class="text-xs font-semibold uppercase mb-2" style="color: var(--text-muted)">Steps</h3>
            <div id="tour-step-list" class="space-y-1"></div>
          </div>
          <div class="flex-1 overflow-y-auto p-6">
            <div id="tour-step-content"></div>
            <div class="flex items-center gap-3 mt-6">
              <button id="tour-prev" onclick="app.tourPrev()" class="neon-btn-outlined neon-btn-cyan text-xs py-1" disabled>Previous</button>
              <button id="tour-next" onclick="app.tourNext()" class="neon-btn-outlined neon-btn-cyan text-xs py-1">Next</button>
              <div class="flex-1"></div>
              <button onclick="app.exportTourMarkdown()" class="neon-btn-outlined neon-btn-cyan text-xs py-1">Export Markdown</button>
            </div>
          </div>
        </div>
      </div>

      <!-- ═══ Tab: Clone ═══ -->
      <div id="tab-clone" class="tab-panel flex-1 overflow-y-auto p-6 hidden">
        <div id="clone-empty" class="tab-empty-state">
          <p>Scan a project first to use the pattern cloner</p>
        </div>
        <div id="clone-content" class="hidden">
          <div class="flex items-center gap-4 mb-4">
            <h2 class="text-lg font-semibold" style="color: var(--text-primary)">Pattern Cloner</h2>
          </div>
          <div class="flex gap-4 mb-4">
            <div class="flex-1">
              <label class="text-xs mb-1 block" style="color: var(--text-secondary)">Select Item to Clone</label>
              <select id="clone-item-select" class="glass-input w-full px-3 py-2 text-sm" onchange="app.onCloneItemChange()">
                <option value="">Choose an item...</option>
              </select>
            </div>
            <div class="flex-1">
              <label class="text-xs mb-1 block" style="color: var(--text-secondary)">New Name</label>
              <input id="clone-new-name" type="text" placeholder="new_component_name"
                class="glass-input w-full px-3 py-2 text-sm">
            </div>
          </div>
          <div class="flex gap-2 mb-4">
            <button onclick="app.previewClone()" class="neon-btn-outlined neon-btn-cyan text-xs py-1">Preview</button>
            <button onclick="app.executeClone()" class="neon-btn-filled neon-btn-green text-xs py-1">Clone &amp; Download</button>
          </div>
          <div id="clone-preview"></div>
        </div>
      </div>

      <!-- ═══ Tab: Boilerplate ═══ -->
      <div id="tab-boilerplate" class="tab-panel flex-1 overflow-y-auto p-6 hidden">
        <div id="boilerplate-empty" class="tab-empty-state">
          <p>Scan a project first to detect boilerplate patterns</p>
        </div>
        <div id="boilerplate-content" class="hidden">
          <div class="flex items-center gap-4 mb-4">
            <h2 class="text-lg font-semibold" style="color: var(--text-primary)">Boilerplate Generator</h2>
            <button onclick="app.detectBoilerplate()" class="neon-btn-outlined neon-btn-cyan text-xs py-1">Detect Patterns</button>
          </div>
          <div id="boilerplate-items" class="mb-4">
            <label class="text-xs mb-1 block" style="color: var(--text-secondary)">Select Items</label>
            <div id="boilerplate-item-list" class="flex flex-wrap gap-2 max-h-32 overflow-y-auto p-2 rounded" style="background: var(--glass-bg); border: 1px solid var(--border-default)"></div>
          </div>
          <div id="boilerplate-patterns" class="card-grid mb-4"></div>
          <div id="boilerplate-template" class="hidden">
            <h3 class="text-sm font-semibold mb-2" style="color: var(--text-secondary)">Generated Template</h3>
            <textarea id="boilerplate-template-editor" class="bp-template-textarea mb-3" rows="12" spellcheck="false"></textarea>
            <div id="boilerplate-variables" class="mb-3"></div>
            <div id="boilerplate-custom-vars" class="mb-3"></div>
            <button onclick="app.addCustomVariable()" class="neon-btn-outlined neon-btn-cyan text-xs py-1 mb-3">+ Add Variable</button>
            <div class="flex items-center gap-2 mb-3">
              <button onclick="app.generateFromTemplate()" class="neon-btn-filled neon-btn-green text-xs py-1">Generate from Template</button>
              <button onclick="app.addVariant()" class="neon-btn-outlined neon-btn-cyan text-xs py-1">+ Add Variant</button>
            </div>
            <div id="boilerplate-variants" class="mb-3 space-y-2"></div>
            <div id="boilerplate-generated" class="mt-3"></div>
          </div>
        </div>
      </div>

      <!-- ═══ Tab: Migration ═══ -->
      <div id="tab-migration" class="tab-panel flex-1 overflow-y-auto p-6 hidden">
        <div id="migration-empty" class="tab-empty-state">
          <p>Scan a project first to detect migration patterns</p>
        </div>
        <div id="migration-content" class="hidden">
          <div class="flex items-center gap-4 mb-4">
            <h2 class="text-lg font-semibold" style="color: var(--text-primary)">Migration Mapper</h2>
            <button onclick="app.detectMigrations()" class="neon-btn-outlined neon-btn-cyan text-xs py-1">Detect Migrations</button>
          </div>
          <div id="migration-patterns" class="space-y-3"></div>
          <div id="migration-preview" class="mt-4"></div>
        </div>
      </div>

      <!-- ═══ Tab: Remix Board ═══ -->
      <div id="tab-remix" class="tab-panel flex-1 overflow-hidden hidden">
        <div id="remix-empty" class="tab-empty-state">
          <p>Scan two or more projects, then drag items here to remix</p>
        </div>
        <div id="remix-content" class="hidden flex flex-1 h-full overflow-hidden">
          <!-- Palette sidebar -->
          <div class="w-72 overflow-y-auto shrink-0" style="border-right: 1px solid var(--border-default)">
            <div class="px-3 py-2 text-xs font-semibold uppercase" style="color: var(--text-muted); border-bottom: 1px solid var(--border-default)">
              Palette
            </div>
            <input id="remix-palette-search" type="text" placeholder="Filter items..." class="remix-palette-search" oninput="app.onRemixPaletteSearch(this.value)">
            <div id="remix-palette" class="p-2 space-y-1"></div>
            <!-- Templates section -->
            <div class="flex items-center justify-between px-3 py-1.5 text-xs font-semibold uppercase" style="color: var(--text-muted); border-top: 1px solid var(--border-default); border-bottom: 1px solid var(--border-default)">
              <span>Templates</span>
              <button onclick="app.remixSaveTemplate()" class="neon-btn-outlined neon-btn-cyan" style="font-size:0.625rem; padding:0.125rem 0.5rem">+ Save</button>
            </div>
            <div id="remix-templates-list" class="p-2 space-y-1"></div>
          </div>
          <!-- Center: controls + canvas + conflicts -->
          <div class="flex-1 flex flex-col min-w-0 overflow-hidden">
            <!-- Controls bar -->
            <div class="remix-controls">
              <input id="remix-project-name" type="text" placeholder="remix-package" value="remix-package"
                class="glass-input px-2 py-1 text-xs w-40">
              <label class="flex items-center gap-1.5 text-xs" style="color: var(--text-secondary)">
                <input type="checkbox" id="remix-include-deps"> Include deps
              </label>
              <div class="flex-1"></div>
              <span id="remix-count" class="text-xs" style="color: var(--text-muted)">0 items</span>
              <div class="remix-btn-group">
                <button onclick="app.remixCheckCompatibility()" class="neon-btn-outlined neon-btn-cyan text-xs py-1">Check</button>
                <button id="remix-build-btn" onclick="app.remixBuild()" class="neon-btn-filled neon-btn-green text-xs py-1" disabled>Build</button>
              </div>
              <div class="remix-btn-group">
                <button id="remix-preview-toggle" onclick="app.remixToggleLivePreview()" class="neon-btn-outlined neon-btn-cyan text-xs py-1">Preview</button>
                <button onclick="app.remixResolveDeps()" class="neon-btn-outlined neon-btn-cyan text-xs py-1">Deps</button>
              </div>
              <button onclick="app.remixClearCanvas()" class="neon-btn-outlined neon-btn-danger text-xs py-1">Clear</button>
            </div>
            <!-- Validation bar -->
            <div id="remix-validation-bar" class="remix-validation-bar hidden"></div>
            <div id="remix-validation-details" class="remix-validation-details hidden"></div>
            <!-- Suggestions panel -->
            <div id="remix-suggestions" class="remix-suggestions-panel hidden"></div>
            <!-- Drop zone canvas -->
            <div id="remix-canvas" class="remix-canvas flex-1 overflow-y-auto">
              <div id="remix-canvas-placeholder" class="remix-canvas-placeholder">
                <div class="text-3xl opacity-20 mb-2">&#x2726;</div>
                <p>Drag items from the palette to build your remix</p>
              </div>
              <div id="remix-canvas-grid" class="remix-canvas-grid hidden"></div>
            </div>
            <!-- Deps panel -->
            <div id="remix-deps-panel" class="remix-deps-panel hidden"></div>
            <!-- Conflicts panel (slides up) -->
            <div id="remix-conflicts" class="remix-conflicts-panel hidden"></div>
          </div>
          <!-- Live Preview sidebar -->
          <div id="remix-live-preview" class="w-80 overflow-y-auto shrink-0 hidden" style="border-left: 1px solid var(--border-default); background: var(--canvas-raised)">
          </div>
        </div>
      </div>

    </main>

    <!-- ═══ Right Detail Panel ═══ -->
    <aside id="preview-panel" class="w-[340px] flex-col hidden shrink-0" style="border-left: 1px solid var(--border-default); background: var(--canvas-raised)">
      <div class="flex items-center justify-between px-4 py-2" style="border-bottom: 1px solid var(--border-default)">
        <div>
          <span id="preview-name" class="font-medium text-sm" style="color: var(--text-primary)"></span>
          <span id="preview-badge" class="ml-2 text-xs px-1.5 py-0.5 rounded"></span>
        </div>
        <button onclick="app.closePreview()" class="text-lg hover:opacity-100 transition-opacity" style="color: var(--text-muted)">&times;</button>
      </div>

      <!-- Code preview -->
      <div class="flex-1 overflow-auto p-4">
        <pre><code id="preview-code" class="text-xs"></code></pre>
      </div>

      <!-- Stats line -->
      <div id="preview-stats" class="px-4 py-2 text-[0.6875rem] hidden" style="color: var(--text-muted); border-top: 1px solid var(--border-default)"></div>

      <!-- Health card -->
      <div id="detail-health-card" class="detail-card mx-3 hidden">
        <div class="detail-card-title">Health</div>
        <div id="detail-health-content"></div>
      </div>

      <!-- Language Breakdown card -->
      <div id="detail-lang-card" class="detail-card mx-3 mb-3 hidden">
        <div class="detail-card-title">Language Breakdown</div>
        <div id="detail-lang-content"></div>
      </div>
    </aside>
  </div>

  <!-- ═══ AI Copilot Floating Widget ═══ -->
  <div id="ai-widget" class="ai-widget hidden">
    <div class="ai-widget-resize"></div>
    <div id="ai-widget-header" class="ai-widget-header">
      <span class="ai-widget-header-title">&#x2604; AI Copilot</span>
      <button onclick="app.aiWidgetSettings()" class="ai-widget-header-btn" title="Settings">&#x2699;</button>
      <button onclick="app.aiWidgetCollapse()" class="ai-widget-header-btn" title="Collapse">&#x2015;</button>
      <button onclick="app.toggleAIWidget()" class="ai-widget-header-btn" title="Close">&#x2715;</button>
    </div>
    <div class="ai-widget-body">
      <div id="ai-widget-settings" class="ai-widget-settings">
        <div class="flex items-center gap-2 mb-2">
          <select id="ai-model" class="glass-input text-xs py-1 px-2 flex-1">
            <option value="deepseek-coder">DeepSeek Coder</option>
            <option value="deepseek-chat">DeepSeek Chat</option>
            <option value="deepseek-reasoner">DeepSeek Reasoner</option>
          </select>
          <button onclick="app.aiClearChat()" class="neon-btn-outlined neon-btn-cyan text-xs py-1 px-2">Clear</button>
        </div>
        <div class="flex items-center gap-2">
          <input id="ai-api-key" type="password" placeholder="DeepSeek API Key"
            class="glass-input flex-1 px-2 py-1 text-xs" autocomplete="off"
            onchange="app.aiSaveKey()">
          <button onclick="app.aiToggleKeyVisibility()" class="text-xs px-1" style="color: var(--text-muted); background:none; border:none; cursor:pointer" title="Show/hide">&#x1F441;</button>
        </div>
      </div>
      <div id="ai-action-bar" class="ai-action-bar">
        <div class="ai-action-spinner"></div>
        <span id="ai-action-text">Executing...</span>
      </div>
      <div id="ai-widget-messages" class="ai-widget-messages">
        <div class="ai-welcome-message">
          <div class="text-sm font-medium mb-1" style="color: var(--text-primary)">AI Copilot</div>
          <div class="text-xs" style="color: var(--text-secondary)">
            I can navigate, search, clone, remix, and more. Try:
            <ul>
              <li>"What's the health score?"</li>
              <li>"Take me to architecture"</li>
              <li>"Clone UserService as AdminService"</li>
              <li>"Add auth functions to remix"</li>
            </ul>
          </div>
        </div>
      </div>
      <div class="ai-widget-input">
        <textarea id="ai-agent-input" placeholder="Ask or command... (Shift+Enter for new line)"
          class="glass-input flex-1 px-2 py-1.5 text-sm ai-query-textarea" rows="1"
          onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();app.aiAgentSend()}"
          oninput="this.style.height='auto';this.style.height=Math.min(this.scrollHeight,80)+'px'"></textarea>
        <button id="ai-agent-send-btn" onclick="app.aiAgentSend()" class="neon-btn-filled neon-btn-cyan text-sm">Send</button>
      </div>
    </div>
  </div>

  <!-- ═══ Package Popover ═══ -->
  <div id="package-popover" class="package-popover hidden">
    <div class="text-xs font-semibold mb-2" style="color: var(--text-secondary)">Package Name</div>
    <input id="package-name-input" type="text" placeholder="my-package"
      class="glass-input w-full px-3 py-1.5 text-sm mb-3">
    <div class="flex gap-2">
      <button onclick="app.confirmPackage()" class="neon-btn-filled neon-btn-green text-xs py-1 flex-1">Generate</button>
      <button onclick="app.hidePackagePopover()" class="neon-btn-outlined neon-btn-cyan text-xs py-1 flex-1">Cancel</button>
    </div>
  </div>

  <!-- ═══ Footer ═══ -->
  <footer class="flex items-center gap-4 px-4 py-2 shrink-0" style="border-top: 1px solid var(--border-default)">
    <div class="flex items-center gap-2 text-xs" style="color: var(--text-muted)">
      <span class="status-dot connected"></span>
      <span id="footer-status">Ready</span>
    </div>
    <div class="flex-1 px-4">
      <div id="progress-bar" class="h-1 rounded-full overflow-hidden hidden" style="background: var(--border-default)">
        <div id="progress-fill" class="h-full transition-all duration-300" style="width:0%; background: var(--accent)"></div>
      </div>
      <span id="progress-text" class="text-[0.625rem] hidden" style="color: var(--text-muted)"></span>
    </div>
    <div class="flex items-center gap-2">
      <span id="selected-count" class="text-xs mr-1" style="color: var(--text-secondary)">0 selected</span>
      <button id="extract-btn" onclick="app.extract()" disabled
        class="neon-btn-outlined neon-btn-cyan text-xs">
        Extract
      </button>
      <button id="smart-extract-btn" onclick="app.smartExtract()" disabled
        class="neon-btn-outlined neon-btn-teal text-xs">
        Extract with Deps
      </button>
      <button id="package-btn" onclick="app.showPackagePopover()" disabled
        class="neon-btn-filled neon-btn-green text-xs">
        Create Package
      </button>
    </div>
    <a id="download-link" download class="hidden neon-btn-outlined neon-btn-cyan text-xs cursor-pointer">
      Download ZIP
    </a>
  </footer>

  <script src="/app.js"></script>
</body>
</html>
